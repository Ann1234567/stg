import{r as l,o as B,c as _,a as s,b as f,w,d as C,s as q,u as F,e as m,F as I,f as M,t as n,i as h,q as R}from"./index-DohTaPA9.js";import{g as S,_ as U}from"./stallBrowse-CXrOnQSZ.js";import{C as D}from"./CommonHeader-D5wAUnYL.js";import{g as P,u as z}from"./mapUtils-kL3KLGgV.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C8QZ-v7H.js";const E={class:"stallBrowse"},H={class:"header-fixed"},j={class:"content"},G={class:"form-card"},J=["onClick"],K={class:"stall-title"},O={class:"stall-info"},Q={class:"info-item"},W={class:"value"},X={class:"font-12"},Y={class:"applied"},Z={class:"total"},ee={class:"info-item"},se={class:"label"},te={class:"time"},ae={class:"info-item"},oe={class:"label"},le=["onClick"],ne={class:"btn-box"},ie={__name:"index",setup(de){const b=F(),i=l([]),u=l(!1),c=l(!1),o=l(!1),g=l(!0),r=l({current:1,size:10}),d=l(null),y=async()=>{try{d.value=await P()}catch(t){console.error(t.message),q("获取位置信息失败")}},v=()=>{u.value=!0,S(r.value).then(t=>{const{records:e,total:p}=t.data;o.value?(i.value=e,o.value=!1):i.value.push(...e),d.value&&(i.value=z(i.value,d.value)),(e.length===0||i.value.length>=p)&&(c.value=!0)}).catch(()=>{o.value||(r.value.current-=1)}).finally(()=>{u.value=!1})};B(async()=>{await y(),await v()});const x=()=>{o.value=!0,r.value.current=1,c.value=!1,v()},k=t=>{if(console.log(t,"store"),!d.value){console.error("未获取到当前位置");return}const e=`https://api.map.baidu.com/direction?origin=${d.value.latitude},${d.value.longitude}&destination=${t.latitude},${t.longitude}&mode=walking&region=全国&output=html&src=webapp.baidu.openAPIdemo`;window.open(e,"_blank")},L=()=>{if(!o.value){if(g.value){g.value=!1,u.value=!1;return}r.value.current+=1,v()}},T=t=>{b.push({path:`/stallBrowse/edit/${t.areaId}`,query:{areaName:t.areaName,address:t.address,openTime:t.openTime,closeTime:t.closeTime,count:t.count,applyCount:t.applyCount,longitude:t.longitude,latitude:t.latitude,distance:t.distance}})};return(t,e)=>{const p=C("van-list"),$=C("van-pull-refresh");return m(),_("div",E,[s("div",H,[f(D,{title:"摊位浏览"})]),s("div",j,[s("div",G,[f($,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value=a),onRefresh:x},{default:w(()=>[f(p,{loading:u.value,"onUpdate:loading":e[0]||(e[0]=a=>u.value=a),finished:c.value,"finished-text":"没有更多了",onLoad:L},{default:w(()=>[(m(!0),_(I,null,M(i.value,(a,N)=>(m(),_("div",{class:"stall-item",key:N,onClick:V=>T(a)},[s("div",K,n(a.areaName),1),s("div",O,[s("div",Q,[e[3]||(e[3]=s("div",{class:"label"},"摊位数量",-1)),s("div",W,[s("span",X,[e[2]||(e[2]=h("已申请：")),s("span",Y,n(a.applyCount),1)]),s("span",Z,"总数："+n(a.count),1)])]),s("div",ee,[s("div",se,[e[4]||(e[4]=s("i",{class:"time-icon"},null,-1)),s("span",te,n(a.openTime)+"~"+n(a.closeTime),1)])]),e[6]||(e[6]=s("div",{class:"divider"},null,-1)),s("div",ae,[s("div",oe,[e[5]||(e[5]=s("i",{class:"location-icon"},null,-1)),h(" "+n(a.address),1)])])]),s("div",{class:"dx-button",onClick:R(V=>k(a),["stop"])},[s("div",ne,[e[7]||(e[7]=s("img",{src:U,style:{width:"1rem",height:"1rem"},alt:""},null,-1)),h(" "+n(a.distance),1)])],8,le)],8,J))),128))]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])])])}}},fe=A(ie,[["__scopeId","data-v-601a73a6"]]);export{fe as default};
