import{C as E}from"./CommonHeader-D5wAUnYL.js";import{g as R,s as B}from"./regulatoryScoring-BFvUh8l1.js";import{a as O}from"./applyVendor-N7zd6jMs.js";import{b as P}from"./home-B3FaBU8H.js";import{r as c,o as z,h as M,c as k,a as l,b as s,w as _,d as i,u as $,e as I,l as j,i as b,t as N,s as d}from"./index-DohTaPA9.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C8QZ-v7H.js";const G={class:"regulatoryScoring"},J={class:"header-fixed"},K={class:"content"},Q={class:"form-card",style:{"margin-top":"7rem"}},W={key:0,class:"qr-info flex flex-between"},X={class:"color-black"},Y={class:"color-gray"},Z={class:"color-black"},L={class:"color-gray"},ee={class:"form-card"},oe={class:"upload-section"},ae={class:"submit-btn"},te={__name:"index",setup(le){const h=$(),x=M(),p=c(!1),m=c(),y=c({userName:"",stall:{stallCode:""}}),o=c({type:"",content:"",images:[],name:"",phone:""}),g=c(!1),q=n=>{g.value=!0;const e=new FormData,v=Array.isArray(n)?n:[n];v.forEach(t=>{e.append("files",t.file)}),O(e).then(t=>{if(t.code===200){o.value.files||(o.value.files=[]);const r=Array.isArray(t.data)?t.data:[t.data];o.value.files.push(...r)}else d(t.msg||"上传失败"),v.forEach(r=>{const u=o.value.images.findIndex(f=>f.file===r.file);u!==-1&&o.value.images.splice(u,1)})}).catch(t=>{d("上传失败"),v.forEach(r=>{const u=o.value.images.findIndex(f=>f.file===r.file);u!==-1&&o.value.images.splice(u,1)})}).finally(()=>{g.value=!1})},D=()=>{h.replace({path:"/scaner",query:{toPath:"/regulatoryScoring"}})},T=n=>{o.value.type=n.selectedOptions[0].value,o.value.typeName=n.selectedOptions[0].text,p.value=!1},S=()=>{if(!m.value){d("请先扫描摊位二维码");return}if(g.value){d("图片上传中，请稍候...");return}if(!o.value.type){d("请选择监管类型");return}if(!o.value.score){d("请进行评分");return}if(!o.value.content){d("请输入监管内容");return}let n={userId:m.value,type:o.value.type,content:o.value.content,score:o.value.score,files:o.value.files};B(n).then(e=>{e.code===200&&h.replace({path:"/submitSuccess"})})},C=c([]);return z(async()=>{x.query.userId&&(m.value=x.query.userId,R(m.value).then(e=>{y.value=e.data}));const{data:n}=await P("supervision_type");C.value=n}),(n,e)=>{const v=i("van-icon"),t=i("van-field"),r=i("van-picker"),u=i("van-popup"),f=i("van-rate"),U=i("van-uploader"),F=i("van-button"),A=i("van-form");return I(),k("div",G,[l("div",J,[s(E,{"back-path":"/home",title:"监管打分"})]),l("div",K,[s(A,{"input-align":"right"},{default:_(()=>{var V,w;return[l("div",Q,[s(t,{"label-width":"8rem",required:"",readonly:"",label:"请扫描摊位二维码"},{"right-icon":_(()=>[s(v,{name:"scan",color:"#1677FF",size:"20",onClick:D})]),_:1}),m.value?(I(),k("div",W,[l("div",X,[e[7]||(e[7]=b(" 摊主姓名：")),l("span",Y,N(y.value.userName),1)]),l("div",Z,[e[8]||(e[8]=b(" 摊位编号：")),l("span",L,N((w=(V=y.value)==null?void 0:V.stall)==null?void 0:w.stallCode),1)])])):j("",!0)]),l("div",ee,[s(t,{modelValue:o.value.typeName,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.typeName=a),"is-link":"",readonly:"",required:"",name:"监管类型",label:"监管类型",placeholder:"请选择监管类型",onClick:e[1]||(e[1]=a=>p.value=!0)},null,8,["modelValue"]),s(u,{show:p.value,"onUpdate:show":e[3]||(e[3]=a=>p.value=a),position:"bottom"},{default:_(()=>[s(r,{columns:C.value.map(a=>({text:a.dictLabel,value:a.dictValue})),onConfirm:T,onCancel:e[2]||(e[2]=a=>p.value=!1)},null,8,["columns"])]),_:1},8,["show"]),s(t,{name:"radio",label:"评分"},{input:_(()=>[s(f,{modelValue:o.value.score,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.score=a),size:15,color:"#F22D22","void-icon":"star","void-color":"#CCCCCC"},null,8,["modelValue"])]),_:1}),s(t,{modelValue:o.value.content,"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.content=a),rows:"4",type:"textarea",required:"",maxlength:"200",placeholder:"请输入，不超过200字","show-word-limit":"",label:"监管内容"},null,8,["modelValue"]),l("div",oe,[e[9]||(e[9]=l("div",{class:"flex flex-between"},[l("div",{class:"section-title"},"上传照片（选填，最多4张）"),l("div",{class:"upload-tip"},"上传的照片不能超过20M")],-1)),s(U,{modelValue:o.value.images,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.images=a),"max-count":4,accept:"image/*",multiple:"","after-read":q},null,8,["modelValue"])]),l("div",ae,[s(F,{block:"",type:"primary",onClick:S,"native-type":"submit"},{default:_(()=>e[10]||(e[10]=[b(" 确认提交 ")])),_:1})])])]}),_:1})])])}}},pe=H(te,[["__scopeId","data-v-5f3ca4c4"]]);export{pe as default};
