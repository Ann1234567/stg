import{C}from"./CommonHeader-D5wAUnYL.js";import{b as k}from"./home-B3FaBU8H.js";import{s as U}from"./request-C8QZ-v7H.js";import{r as c,o as N,c as T,a as l,b as s,w as _,d as p,u as q,e as A,i as D,s as u}from"./index-DohTaPA9.js";import{a as E}from"./applyVendor-N7zd6jMs.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";function I(y){return U({url:"/stg/consultProposal/submit",method:"post",data:y})}const O={class:"suggestions"},P={class:"header-fixed"},$={class:"content"},F={class:"form-card",style:{"margin-top":"6.25rem"}},M={class:"form-card"},R={class:"upload-section"},S={class:"contact-info"},j={class:"submit-btn"},H={__name:"index",setup(y){const x=q(),e=c({type:"",content:"",images:[],name:"",phone:""}),m=c(!1),b=c([]),V=o=>{e.value.type=o.selectedOptions[0].value,e.value.typeName=o.selectedOptions[0].text,m.value=!1},g=()=>{if(f.value){u("图片上传中，请稍候...");return}if(!e.value.type){u("请选择诉求类型");return}if(!e.value.content){u("请输入诉求内容");return}if(!e.value.name){u("请输入姓名");return}if(!e.value.phone){u("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(e.value.phone)){u("请输入正确的手机号");return}let o={type:e.value.type,content:e.value.content,files:e.value.files,phone:e.value.phone,name:e.value.name};I(o).then(t=>{t.code===200&&x.replace({path:"/submitSuccess"})})},f=c(!1),h=o=>{f.value=!0;const t=new FormData,i=Array.isArray(o)?o:[o];i.forEach(n=>{t.append("files",n.file)}),E(t).then(n=>{if(n.code===200){e.value.files||(e.value.files=[]);const d=Array.isArray(n.data)?n.data:[n.data];e.value.files.push(...d)}else u(n.msg||"上传失败"),i.forEach(d=>{const r=e.value.images.findIndex(v=>v.file===d.file);r!==-1&&e.value.images.splice(r,1)})}).catch(n=>{u("上传失败"),i.forEach(d=>{const r=e.value.images.findIndex(v=>v.file===d.file);r!==-1&&e.value.images.splice(r,1)})}).finally(()=>{f.value=!1})};return N(async()=>{const{data:o}=await k("statement_type");b.value=o}),(o,t)=>{const i=p("van-field"),n=p("van-picker"),d=p("van-popup"),r=p("van-uploader"),v=p("van-button"),w=p("van-form");return A(),T("div",O,[l("div",P,[s(C,{title:"咨询建议"})]),l("div",$,[s(w,{"input-align":"right"},{default:_(()=>[l("div",F,[s(i,{modelValue:e.value.typeName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.value.typeName=a),"is-link":"",readonly:"",required:"",name:"诉求类型",label:"诉求类型",placeholder:"请选择诉求类型",onClick:t[1]||(t[1]=a=>m.value=!0)},null,8,["modelValue"]),s(d,{show:m.value,"onUpdate:show":t[3]||(t[3]=a=>m.value=a),position:"bottom"},{default:_(()=>[s(n,{columns:b.value.map(a=>({text:a.dictLabel,value:a.dictValue})),onConfirm:V,onCancel:t[2]||(t[2]=a=>m.value=!1)},null,8,["columns"])]),_:1},8,["show"])]),l("div",M,[s(i,{modelValue:e.value.content,"onUpdate:modelValue":t[4]||(t[4]=a=>e.value.content=a),rows:"4",type:"textarea",required:"",maxlength:"200",placeholder:"请输入，不超过200字","show-word-limit":"",label:"诉求内容"},null,8,["modelValue"]),l("div",R,[t[8]||(t[8]=l("div",{class:"flex flex-between"},[l("div",{class:"section-title"},"诉求照片"),l("div",{class:"upload-tip"},"上传的照片不能超过20M")],-1)),s(r,{modelValue:e.value.images,"onUpdate:modelValue":t[5]||(t[5]=a=>e.value.images=a),"max-count":4,accept:"image/*",multiple:"","after-read":h},null,8,["modelValue"])]),l("div",S,[t[9]||(t[9]=l("div",{class:"section-title"},"联系方式",-1)),s(i,{modelValue:e.value.name,"onUpdate:modelValue":t[6]||(t[6]=a=>e.value.name=a),required:"",label:"姓名",placeholder:"请填写"},null,8,["modelValue"]),s(i,{modelValue:e.value.phone,"onUpdate:modelValue":t[7]||(t[7]=a=>e.value.phone=a),required:"",label:"手机号",placeholder:"请填写"},null,8,["modelValue"])]),l("div",j,[s(v,{block:"",type:"primary",onClick:g,"native-type":"submit"},{default:_(()=>t[10]||(t[10]=[D(" 确认提交 ")])),_:1})])])]),_:1})])])}}},X=B(H,[["__scopeId","data-v-d627ced1"]]);export{X as default};
