import{a as q,_ as z,s as W}from"./stallBrowse-CXrOnQSZ.js";import{C as j}from"./CommonHeader-D5wAUnYL.js";import{x as G,y as $,z as J,A as K,b as T,B as Q,C as X,r as n,o as Y,h as Z,p as ee,c as f,a as e,t as l,i as S,w as H,d as M,u as se,e as g,F as te,f as oe,n as O,l as V}from"./index-DohTaPA9.js";import{g as ae}from"./mapUtils-kL3KLGgV.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-C8QZ-v7H.js";let N;const ne={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1,destroyOnClose:!1};let ie=$({},ne);function re(){({instance:N}=J({setup(){const{state:r,toggle:u}=K();return()=>T(X,Q(r,{"onUpdate:show":u}),null)}}))}function ue(k){return G?new Promise((r,u)=>{N||re(),N.open($({},ie,k,{callback:c=>{(c==="confirm"?r:u)(c)}}))}):Promise.resolve(void 0)}const ce="/assets/twxq-BEFHiLf6.png",de={class:"stallBrowse"},ve={class:"header-fixed"},me={class:"content"},pe={class:"stall-list"},_e={class:"stall-item"},fe={class:"stall-title"},ge={class:"stall-info"},he={class:"info-item"},be={class:"value"},Ce={class:"font-12"},we={class:"applied"},ye={class:"total"},Be={class:"info-item"},Te={class:"label"},ke={class:"time"},xe={class:"info-item"},Le={class:"label"},Ie={class:"btn-box"},Se={class:"stall-detail"},Ne={class:"detail-list"},Pe={class:"item-number"},De={class:"item-content"},He={class:"item-code"},Me={class:"item-status"},Oe={class:"item-tags"},Ve={key:0,class:"tag tag-fire"},$e={key:1,class:"tag tag-danger"},Fe={class:"item-action"},Ae=["disabled","onClick"],Ue={__name:"edit",setup(k){const r=n(!0),u=se(),c=Z(),o=n({});Y(()=>{v.value.areaId=c.params.areaId,o.value={...c.query},U(),L()});const P=ee(()=>{var p,_;if(!((p=o.value)!=null&&p.openTime)||!((_=o.value)!=null&&_.closeTime))return!1;const t=new Date,s=t.getHours()*60+t.getMinutes(),[m,I]=o.value.openTime.split(":").map(Number),[C,w]=o.value.closeTime.split(":").map(Number),y=m*60+I,B=C*60+w;return s>=y&&s<=B}),d=n(!1),x=n(!1),i=n(!1),v=n({current:1,size:10,areaId:""}),h=n([]),L=()=>{d.value=!0,q(v.value).then(t=>{const{records:s,total:m}=t.data;i.value?(h.value=s,i.value=!1):h.value.push(...s),(s.length===0||h.value.length>=m)&&(x.value=!0)}).catch(()=>{i.value||(v.value.current-=1),showToast("加载失败")}).finally(()=>{d.value=!1})},F=()=>{i.value=!0,v.value.current=1,x.value=!1,L()},A=()=>{if(!i.value){if(r.value){r.value=!1,d.value=!1;return}v.value.current+=1,L()}},b=n(null),U=async()=>{try{b.value=await ae()}catch(t){console.error(t.message),showToast("获取位置信息失败")}},E=t=>{if(console.log(t,"store"),!b.value){console.error("未获取到当前位置");return}const s=`https://api.map.baidu.com/direction?origin=${b.value.latitude},${b.value.longitude}&destination=${t.latitude},${t.longitude}&mode=walking&region=全国&output=html&src=webapp.baidu.openAPIdemo`;window.open(s,"_blank")},R=t=>{ue({title:"预约确认",message:`确定要预约摊位编号：${t.stallCode} 吗？`,confirmButtonText:"确定",cancelButtonText:"取消"}).then(()=>{W({stallId:t.stallId}).then(s=>{u.push("/merchantPortal")})}).catch(()=>{})};return(t,s)=>{var C,w,y,B,p,_;const m=M("van-list"),I=M("van-pull-refresh");return g(),f("div",de,[e("div",ve,[T(j,{title:"摊位详情"})]),e("div",me,[e("div",pe,[e("div",_e,[e("div",fe,l((C=o.value)==null?void 0:C.areaName),1),e("div",ge,[e("div",he,[s[4]||(s[4]=e("div",{class:"label"},"摊位数量",-1)),e("div",be,[e("span",Ce,[s[3]||(s[3]=S("已申请：")),e("span",we,l((w=o.value)==null?void 0:w.applyCount),1)]),e("span",ye,"总数："+l((y=o.value)==null?void 0:y.count),1)])]),s[7]||(s[7]=e("div",{class:"divider"},null,-1)),e("div",Be,[e("div",Te,[s[5]||(s[5]=e("i",{class:"time-icon"},null,-1)),e("span",ke,l((B=o.value)==null?void 0:B.openTime)+"~"+l((p=o.value)==null?void 0:p.closeTime),1)])]),e("div",xe,[e("div",Le,[s[6]||(s[6]=e("i",{class:"location-icon"},null,-1)),S(" "+l((_=o.value)==null?void 0:_.address),1)])])]),e("div",{class:"dx-button",onClick:s[0]||(s[0]=a=>E(o.value))},[e("div",Ie,[s[8]||(s[8]=e("img",{src:z,style:{width:"1rem",height:"1rem"},alt:""},null,-1)),S(" "+l(o.value.distance),1)])])])]),e("div",Se,[s[10]||(s[10]=e("div",{class:"detail-title"},[e("div",{class:"notice-icon"},[e("img",{src:ce,alt:""})])],-1)),T(I,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=a=>i.value=a),onRefresh:F},{default:H(()=>[T(m,{loading:d.value,"onUpdate:loading":s[1]||(s[1]=a=>d.value=a),finished:x.value,"finished-text":"没有更多了",onLoad:A},{default:H(()=>[e("div",Ne,[(g(!0),f(te,null,oe(h.value,(a,D)=>(g(),f("div",{class:"detail-item",key:D},[e("div",Pe,l(String(D+1).padStart(2,"0")),1),e("div",De,[e("div",He,"摊位编号："+l(a.stallCode),1),e("div",Me,[s[9]||(s[9]=e("span",null,"可否预约：",-1)),e("span",{class:O(a.applyStatus?"can-book":"cannot-book")},l(a.applyStatus?"可预约":"不可预约"),3)]),e("div",Oe,[a.isFire===1?(g(),f("span",Ve,"禁明火")):V("",!0),a.isDetonation===1?(g(),f("span",$e,"禁易燃易爆")):V("",!0)])]),e("div",Fe,[e("button",{class:O(["book-btn",{disabled:!P.value}]),disabled:!P.value,onClick:Ee=>R(a)}," 预约 ",10,Ae)])]))),128))])]),_:1},8,["loading","finished"])]),_:1},8,["modelValue"])])])])}}},Je=le(Ue,[["__scopeId","data-v-16c7a520"]]);export{Je as default};
